#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <assert.h>

int main() {
	// disable buffering
	setbuf(stdin, NULL);
	setbuf(stdout, NULL);

	size_t stack_var;

	printf("allocating 2 buffers\n");
	intptr_t *bf1 = malloc(128);
	intptr_t *bf2 = malloc(128);

	printf("Freeing buffers\n");
	free(bf1);
	free(bf2);

	printf("tcache list: [ %p ==> %p ]\n", bf2, bf1);
	bf2[0] = (intptr_t)&stack_var;
	printf("new tcache list: [ %p ==> %p ]\n", bf2, &stack_var);

	printf("updated tcache list: [ %p ]\n", &stack_var);

	intptr_t *c = malloc(128);

	assert((long)&stack_var == (long)c);
	return 0;
}
